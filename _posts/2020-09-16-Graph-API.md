---
title: Windows vs Microsoft
---

Working on a recent project I've decided to script the registration of Azure Applications, as I'm not dealing with one application, not five, not ten, but almost a dozen of Azure Applicatoins with almost the same configurations.

The obvious choice seems to be AzureAD poweshell module, easy to set-up, but this went quite ugly in the end, due to various endpoints are required for different configurations, so really I've been dealing with a mixture of Windows Graph API, Microsoft Graph API v1, and Microsoft Graph API beta.

My take from this task:

| 　                       | endpoint                          | common used client                    | Api (for pemissions) in Azure   App |
|--------------------------|-----------------------------------|---------------------------------------|-------------------------------------|
| Windows Graph Api        | https://graph.windows.net         | Azure AD powershell module/Azure Cli? | Azure Active Directory Graph        |
| Microsoft Graph Api      | https://graph.microsoft.com/      | 　                                    | Microsoft Graph                     |
| Microsoft Graph Api beta | https://graph.microsoft.com/beta  | Microsoft.Graph powershell module     | Microsoft Graph                     |


Minimum Permissions:
I was running as an AAD user and then have decided to run the process as a sp, so it's guraranteed no interactive login is required.
- Connect-AzureAD can take a client credential token
- The actuall application permission needed are usually well documented, so if you are hitting an insufficent privilege error calling graph api, check the Permissions section of the API reference, e.g.:
https://docs.microsoft.com/en-us/graph/api/serviceprincipal-post-serviceprincipals?view=graph-rest-1.0&tabs=http
- Active Directory Roles, e.g.: Application Administration, is effectively a subset of graph api permissions.

